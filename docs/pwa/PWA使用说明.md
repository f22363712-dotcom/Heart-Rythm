# 心动积分 PWA 使用说明

## 📱 什么是 PWA？

PWA（Progressive Web App，渐进式网页应用）是一种可以像原生应用一样安装到手机/电脑的网页应用。安装后：
- ✅ 可以添加到主屏幕，像普通 App 一样打开
- ✅ 支持离线访问（缓存了静态资源）
- ✅ 更快的加载速度
- ✅ 沉浸式全屏体验（无浏览器地址栏）

---

## 🚀 快速开始

### 第一步：启动服务

1. 双击运行 `start_pwa.bat` 脚本
2. 等待服务启动完成（会自动打开两个命令行窗口）
3. 看到"服务启动成功"提示后，记下访问地址

**重要提示：**
- 服务启动后，**不要关闭**那两个命令行窗口（后端和前端）
- 关闭窗口会导致服务停止

---

## 💻 电脑端使用

### 访问地址
在浏览器中打开以下任一地址：
- `http://127.0.0.1:5000`
- `http://localhost:5000`

### 安装 PWA（推荐）

#### Chrome 浏览器
1. 访问上述地址
2. 等待几秒，页面底部会弹出安装提示
3. 点击"立即安装"按钮
4. 或者点击地址栏右侧的 **⊕ 安装图标**

#### Edge 浏览器
1. 访问上述地址
2. 点击地址栏右侧的 **⊕ 应用可用** 图标
3. 点击"安装"

#### 安装后
- 桌面会出现"心动积分"图标
- 双击图标即可打开，无需浏览器
- 体验类似原生应用

---

## 📱 手机端使用

### 前提条件
**手机和电脑必须连接到同一个 WiFi 网络！**

### 访问地址
在手机浏览器中打开：
- `http://192.168.10.17:5000`

**注意：** 如果你的电脑 IP 地址变化了，需要：
1. 在电脑上打开命令提示符（cmd）
2. 输入 `ipconfig` 并回车
3. 找到"无线局域网适配器 WLAN"下的"IPv4 地址"
4. 使用新的 IP 地址访问（格式：`http://新IP:5000`）

### 安装 PWA 到手机

#### Android 手机（Chrome 浏览器）
1. 用 Chrome 浏览器访问上述地址
2. 点击右上角 **⋮** 菜单
3. 选择"**添加到主屏幕**"或"**安装应用**"
4. 点击"添加"或"安装"
5. 主屏幕会出现"心动积分"图标

#### iPhone（Safari 浏览器）
1. 用 Safari 浏览器访问上述地址
2. 点击底部的 **分享按钮**（方框带向上箭头）
3. 向下滚动，找到"**添加到主屏幕**"
4. 点击"添加"
5. 主屏幕会出现"心动积分"图标

#### 安装后的优势
- 📱 像普通 App 一样从主屏幕打开
- 🚀 加载速度更快（有缓存）
- 📴 部分功能支持离线访问
- 🎨 全屏沉浸式体验

---

## ❓ 常见问题解答

### Q1: 一定要在 Edge 或 Chrome 浏览器打开吗？

**A:**
- **电脑端：** 强烈推荐使用 **Chrome** 或 **Edge** 浏览器
  - 这两个浏览器对 PWA 支持最好
  - Firefox 也可以访问，但不支持安装 PWA
  - IE 浏览器不支持（已过时）

- **手机端：**
  - Android：推荐 **Chrome** 浏览器
  - iPhone：推荐 **Safari** 浏览器（系统自带）
  - 其他浏览器（如 Firefox、UC 等）可能不支持安装 PWA

### Q2: 在移动端下载和使用 PWA 也需要在电脑上运行脚本吗？

**A:** 是的，必须！

**原因：**
- 这个 PWA 应用的服务器运行在你的电脑上
- 手机只是通过网络访问电脑上的服务
- 如果电脑上的服务停止了，手机就无法访问

**工作流程：**
```
电脑运行脚本 → 启动服务器 → 手机通过 WiFi 访问 → 安装 PWA
```

**使用场景：**
1. **在家使用：** 电脑开着，手机可以随时访问
2. **离线功能：** 安装 PWA 后，部分静态页面可以离线查看（但数据操作仍需联网）
3. **外出使用：** 如果需要外出使用，需要：
   - 将服务部署到云服务器（如阿里云、腾讯云）
   - 或使用内网穿透工具（如 frp、ngrok）

### Q3: 为什么访问 http://your-server:5000 没有反应？

**A:** `your-server` 只是一个占位符，不是真实地址！

**正确做法：**
- 电脑访问：`http://127.0.0.1:5000`
- 手机访问：`http://192.168.10.17:5000`（你的电脑 IP）

### Q4: 手机访问提示"无法连接"怎么办？

**检查清单：**
1. ✅ 电脑和手机是否连接同一个 WiFi？
2. ✅ 电脑上的服务是否正在运行？（检查命令行窗口）
3. ✅ 电脑防火墙是否阻止了端口 5000？
   - 解决方法：在 Windows 防火墙中允许 Python 程序通过
4. ✅ IP 地址是否正确？
   - 在电脑上运行 `ipconfig` 查看当前 IP

### Q5: 安装 PWA 后，关闭电脑还能用吗？

**A:** 不能！

- PWA 只是一个"快捷方式"，本质上还是访问电脑上的服务
- 关闭电脑或停止服务后，手机无法访问
- 如果需要随时随地使用，建议部署到云服务器

### Q6: 如何卸载 PWA？

#### 电脑端
- **Chrome：** 打开应用 → 右上角 ⋮ → 卸载
- **Edge：** 打开应用 → 右上角 ⋯ → 卸载

#### 手机端
- **Android：** 长按图标 → 卸载/删除
- **iPhone：** 长按图标 → 删除 App

### Q7: PWA 可以离线使用吗？

**A:** 部分功能可以！

**可以离线访问的内容：**
- ✅ 静态页面（首页、登录页等）
- ✅ 样式和图标
- ✅ 已缓存的图片

**需要联网的功能：**
- ❌ 登录验证
- ❌ 数据查询（积分、奖励等）
- ❌ 数据提交（添加积分、兑换奖励等）

---

## 🔧 高级配置

### 修改服务器端口

如果端口 5000 或 8000 被占用，可以修改：

1. **修改前端端口：**
   - 编辑 `frontend/main.py`
   - 找到最后一行：`app.run(host="0.0.0.0", port=5000, debug=True)`
   - 将 `5000` 改为其他端口（如 `5001`）

2. **修改后端端口：**
   - 编辑 `start_pwa.bat`
   - 找到：`python -m uvicorn api.main:app --host 0.0.0.0 --port 8000`
   - 将 `8000` 改为其他端口（如 `8001`）

### 部署到云服务器（可选）

如果想随时随地访问，可以将服务部署到云服务器：

1. 购买云服务器（阿里云、腾讯云等）
2. 安装 Python 和依赖
3. 上传项目代码
4. 配置域名和 HTTPS（PWA 在生产环境需要 HTTPS）
5. 使用 Nginx 反向代理
6. 配置开机自启动

---

## 📞 技术支持

如果遇到问题：
1. 检查命令行窗口是否有错误信息
2. 查看浏览器控制台（F12）的错误日志
3. 确认网络连接和防火墙设置

---

## 🎉 开始使用

现在你已经了解了所有使用方法，快去体验吧！

1. 运行 `start_pwa.bat`
2. 在浏览器中打开对应地址
3. 安装 PWA 到主屏幕
4. 开始记录你们的美好时光！💕

---

**版本：** v2.1
**更新日期：** 2025-01-23

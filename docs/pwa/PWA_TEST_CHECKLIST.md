# PWA 功能测试清单

## 📋 测试环境准备

### 必需条件
- [ ] Python 3.8+ 已安装
- [ ] 依赖包已安装 (`pip install -r requirements.txt`)
- [ ] 后端服务运行正常 (端口 8000)
- [ ] 前端服务运行正常 (端口 5000)
- [ ] 使用支持PWA的浏览器（Chrome、Edge、Safari等）

### 测试设备
- [ ] 桌面浏览器（Chrome/Edge）
- [ ] Android设备（Chrome浏览器）
- [ ] iOS设备（Safari浏览器）

---

## 🧪 基础功能测试

### 1. Service Worker 注册
- [ ] 打开 Chrome DevTools → Application → Service Workers
- [ ] 确认 Service Worker 状态为 "activated and is running"
- [ ] 控制台显示 "✅ Service Worker 注册成功"
- [ ] 查看 Service Worker 版本号为 v2.1.1

**测试步骤：**
```
1. 访问 http://localhost:5000
2. 打开开发者工具（F12）
3. 切换到 Application 标签
4. 左侧选择 Service Workers
5. 确认状态显示为绿色圆点
```

### 2. Manifest 配置
- [ ] Application → Manifest 显示正确信息
- [ ] 应用名称：心动积分 - 爱的印记本
- [ ] 短名称：心动积分
- [ ] 主题色：#e891a9
- [ ] 背景色：#faf5f7
- [ ] 显示模式：standalone
- [ ] 图标列表完整（8个尺寸）

**测试步骤：**
```
1. DevTools → Application → Manifest
2. 检查所有字段是否正确
3. 点击图标链接，确认图标可访问
```

### 3. 缓存功能
- [ ] Cache Storage 中存在 `heart-rhythm-v2.1.1` 缓存
- [ ] 静态资源已缓存（CSS、JS、字体）
- [ ] 动态缓存 `heart-rhythm-dynamic-v2.1.1` 已创建
- [ ] 缓存资源数量合理（不超过限制）

**测试步骤：**
```
1. DevTools → Application → Cache Storage
2. 展开缓存列表
3. 检查缓存内容
4. 确认关键资源已缓存
```

---

## 📱 安装功能测试

### 4. 桌面浏览器安装

#### Chrome/Edge
- [ ] 地址栏右侧显示安装图标（+）
- [ ] 点击安装图标弹出安装对话框
- [ ] 对话框显示应用名称和图标
- [ ] 点击"安装"后应用添加到系统
- [ ] 可从开始菜单/应用列表启动

**测试步骤：**
```
1. 访问应用首页
2. 等待3-5秒
3. 观察地址栏右侧
4. 点击安装图标
5. 确认安装
6. 检查系统应用列表
```

#### 自定义安装横幅
- [ ] 首次访问时底部显示安装横幅
- [ ] 横幅包含应用图标和说明文字
- [ ] "立即安装"按钮可点击
- [ ] "稍后"按钮可关闭横幅
- [ ] 关闭后不再显示（localStorage记录）

**测试步骤：**
```
1. 清除 localStorage
2. 刷新页面
3. 等待安装横幅出现
4. 测试两个按钮功能
```

### 5. Android 设备安装
- [ ] Chrome 自动显示"添加到主屏幕"提示
- [ ] 或通过菜单 → "添加到主屏幕"
- [ ] 安装后主屏幕显示应用图标
- [ ] 图标显示正确（💕心形图标）
- [ ] 点击图标以全屏模式打开
- [ ] 无浏览器地址栏和工具栏

**测试步骤：**
```
1. 在Android设备上用Chrome访问应用
2. 等待自动提示或手动添加
3. 确认安装
4. 返回主屏幕查看图标
5. 点击图标启动应用
```

### 6. iOS 设备安装
- [ ] Safari 浏览器访问应用
- [ ] 点击分享按钮（底部中间）
- [ ] 滚动找到"添加到主屏幕"
- [ ] 显示应用名称和图标预览
- [ ] 确认后图标添加到主屏幕
- [ ] 启动后全屏显示

**测试步骤：**
```
1. 在iOS设备上用Safari访问应用
2. 点击底部分享按钮
3. 选择"添加到主屏幕"
4. 编辑名称（可选）
5. 点击"添加"
6. 测试启动
```

---

## 🔌 离线功能测试

### 7. 离线访问
- [ ] 在线访问应用，浏览多个页面
- [ ] 断开网络连接
- [ ] 刷新页面，应用仍可访问
- [ ] 已缓存的页面正常显示
- [ ] 静态资源（CSS、JS）正常加载
- [ ] 图片和字体正常显示

**测试步骤：**
```
1. 正常访问应用
2. 浏览首页、登录页、仪表板
3. DevTools → Network → Offline
4. 刷新页面
5. 检查页面是否正常显示
```

### 8. API 离线处理
- [ ] 离线状态下尝试登录
- [ ] 显示友好的错误提示
- [ ] 提示信息："网络连接失败，请检查网络连接后重试"
- [ ] 不显示技术性错误信息
- [ ] 恢复网络后功能正常

**测试步骤：**
```
1. 断开网络
2. 尝试登录
3. 观察错误提示
4. 恢复网络
5. 重新登录
```

### 9. 缓存更新
- [ ] 修改 Service Worker 版本号
- [ ] 刷新页面
- [ ] 显示"发现新版本"提示
- [ ] 点击确定后页面重新加载
- [ ] 旧缓存被清除
- [ ] 新缓存生效

**测试步骤：**
```
1. 修改 sw.js 中的 CACHE_VERSION
2. 刷新页面
3. 等待更新提示
4. 确认更新
5. 检查 Cache Storage
```

---

## 📐 响应式布局测试

### 10. 桌面端（>768px）
- [ ] 导航栏完整显示
- [ ] 卡片布局合理
- [ ] 按钮大小适中
- [ ] 表单元素正常
- [ ] 浮动爱心动画流畅

**测试步骤：**
```
1. 浏览器窗口最大化
2. 浏览各个页面
3. 检查布局和样式
```

### 11. 平板端（576px-768px）
- [ ] 标题字号适当缩小
- [ ] 导航栏可折叠
- [ ] 卡片间距优化
- [ ] 按钮大小调整
- [ ] 表单字号16px（防止iOS缩放）

**测试步骤：**
```
1. DevTools → Toggle device toolbar
2. 选择 iPad 或自定义尺寸
3. 测试各页面布局
```

### 12. 手机端（<576px）
- [ ] 标题进一步缩小
- [ ] 导航栏汉堡菜单
- [ ] 卡片圆角16px
- [ ] 按钮适合触摸
- [ ] 浮动爱心减少到2个
- [ ] 页脚文字缩小

**测试步骤：**
```
1. DevTools → iPhone 12 Pro
2. 测试所有页面
3. 检查触摸目标大小
```

### 13. 横屏模式
- [ ] 内容区域padding减小
- [ ] 卡片间距优化
- [ ] 页脚margin减小
- [ ] 整体布局紧凑

**测试步骤：**
```
1. 手机横屏
2. 或 DevTools 旋转设备
3. 检查布局适配
```

---

## 👆 触摸优化测试

### 14. 触摸目标大小
- [ ] 所有按钮最小44px高度
- [ ] 导航链接易于点击
- [ ] 列表项触摸区域足够大
- [ ] 表单输入框易于聚焦

**测试步骤：**
```
1. 在触摸设备上测试
2. 尝试点击各种元素
3. 确认无误触问题
```

### 15. 触摸反馈
- [ ] 按钮按下时缩小（scale 0.95）
- [ ] 卡片点击时透明度变化
- [ ] 无悬停效果（移动端）
- [ ] 触摸反馈流畅

**测试步骤：**
```
1. 触摸各种可交互元素
2. 观察视觉反馈
3. 确认体验流畅
```

---

## 🎨 特殊模式测试

### 16. 减少动画模式
- [ ] 系统设置启用"减少动画"
- [ ] 浮动爱心不显示
- [ ] 过渡动画极短
- [ ] 页面仍可正常使用

**测试步骤：**
```
1. 系统设置 → 辅助功能 → 减少动画
2. 刷新应用
3. 检查动画效果
```

### 17. 高对比度模式
- [ ] 系统启用高对比度
- [ ] 卡片边框加粗
- [ ] 按钮边框明显
- [ ] 文字清晰可读

**测试步骤：**
```
1. 系统设置 → 辅助功能 → 高对比度
2. 刷新应用
3. 检查对比度
```

### 18. PWA 模式检测
- [ ] 从主屏幕启动应用
- [ ] 控制台显示"📱 运行在 PWA 模式"
- [ ] HTML 添加 pwa-mode 类
- [ ] 刘海屏适配生效
- [ ] 底部手势条留白

**测试步骤：**
```
1. 安装应用到主屏幕
2. 从主屏幕启动
3. 打开控制台（如可能）
4. 检查页面布局
```

---

## ⚡ 性能测试

### 19. Lighthouse 审计
- [ ] PWA 评分 > 90
- [ ] Performance 评分 > 80
- [ ] Accessibility 评分 > 90
- [ ] Best Practices 评分 > 90
- [ ] SEO 评分 > 80

**测试步骤：**
```
1. DevTools → Lighthouse
2. 选择 Progressive Web App
3. 点击 Generate report
4. 查看评分和建议
```

### 20. 加载性能
- [ ] 首次加载 < 3秒
- [ ] 二次加载 < 1秒（缓存）
- [ ] Service Worker 激活 < 500ms
- [ ] 页面可交互时间 < 2秒

**测试步骤：**
```
1. DevTools → Network → Disable cache
2. 刷新页面，记录加载时间
3. 再次刷新（使用缓存）
4. 对比加载时间
```

### 21. 缓存效率
- [ ] 静态资源100%缓存命中
- [ ] 动态资源合理缓存
- [ ] 缓存大小 < 10MB
- [ ] 无重复缓存

**测试步骤：**
```
1. 清除缓存
2. 浏览应用
3. 检查 Cache Storage 大小
4. 查看缓存命中率
```

---

## 🔐 安全测试

### 22. HTTPS 要求
- [ ] 生产环境使用 HTTPS
- [ ] Service Worker 仅在 HTTPS 下工作
- [ ] 或在 localhost 下工作
- [ ] 证书有效

**测试步骤：**
```
1. 部署到生产环境
2. 确认使用 HTTPS
3. 检查证书状态
```

### 23. 内容安全策略
- [ ] CSP 头配置正确
- [ ] 允许必要的外部资源
- [ ] 阻止不安全的内联脚本
- [ ] 无 CSP 违规警告

**测试步骤：**
```
1. 检查响应头
2. 查看控制台 CSP 警告
3. 确认无违规
```

---

## 📊 测试结果汇总

### 通过标准
- [ ] 所有基础功能测试通过
- [ ] 至少一个平台安装测试通过
- [ ] 离线功能正常工作
- [ ] 响应式布局适配良好
- [ ] Lighthouse PWA 评分 > 90

### 已知问题
记录测试中发现的问题：

```
1.
2.
3.
```

### 改进建议
记录可以改进的地方：

```
1.
2.
3.
```

---

## 📝 测试签名

- **测试人员**: _______________
- **测试日期**: _______________
- **测试环境**: _______________
- **测试结果**: ☐ 通过  ☐ 部分通过  ☐ 未通过

---

**💕 心动积分 PWA 测试清单 v2.1.0**

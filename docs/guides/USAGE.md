# 心动积分系统 v2.0 - 使用说明

## 🚀 快速开始

### 1. 启动系统

**方式一：使用启动脚本（推荐）**
```bash
# Windows
start.bat

# Linux/Mac
./start.sh
```

**方式二：手动启动**
```bash
# 启动后端（端口8000）
python -m uvicorn backend.api.main:app --host 0.0.0.0 --port 8000 --reload

# 启动前端（端口5000）
python frontend/main.py
```

### 2. 访问系统

- **前端界面**: http://localhost:5000
- **后端API文档**: http://localhost:8000/docs
- **后端健康检查**: http://localhost:8000/health

---

## 👥 默认账号

### 管理员账号
- **用户名**: `admin`
- **密码**: `admin123`
- **权限**: 可以查看所有用户数据、系统统计

### 情侣账号（示例）
- **用户名**: `couple_test001`
- **密码**: `123456`
- **权限**: 只能管理自己的积分和奖励

> 💡 所有从旧系统迁移的情侣账号格式为：`couple_{原ID}`，默认密码：`123456`

---

## 📖 功能说明

### 1. 用户注册与登录

#### 注册新账号
1. 访问 http://localhost:5000/login
2. 点击"立即注册"
3. 填写信息：
   - 用户名（至少3个字符）
   - 密码（至少6个字符）
   - 第一个人的名字
   - 第二个人的名字
4. 点击"注册"按钮

#### 登录系统
1. 访问 http://localhost:5000/login
2. 输入用户名和密码
3. 点击"登录"按钮
4. 登录成功后自动跳转到首页

### 2. 积分管理

#### 添加积分
- 在首页点击"添加积分"按钮
- 输入积分变化（正数增加，负数减少）
- 输入变化原因
- 点击"确定"

#### 查看积分历史
- 进入"仪表板"页面
- 查看所有积分变动记录
- 包括时间、原因、变化值

### 3. 奖励管理

#### 查看基础奖励列表
- 系统预设了10个基础奖励供参考
- 包括：浪漫晚餐、看电影、周末旅行等

#### 创建专属奖励
1. 进入"奖励管理"页面
2. 点击"创建奖励"
3. 填写信息：
   - 奖励名称
   - 所需积分
   - 库存数量
   - 奖励描述
4. 点击"保存"

#### 兑换奖励
1. 在奖励列表中选择想要的奖励
2. 确认积分足够且有库存
3. 点击"兑换"按钮
4. 系统自动扣除积分并减少库存

### 4. 管理员功能

#### 查看系统统计
- 情侣总数
- 总积分数
- 兑换次数

#### 查看所有用户
- 所有情侣的信息
- 各自的积分情况

#### 查看所有兑换记录
- 全局兑换历史
- 包括用户、奖励、时间等信息

---

## 🔐 安全特性

### 1. 密码安全
- 使用SHA256哈希加密存储
- 不保存明文密码
- 管理员也无法查看用户密码

### 2. 数据隔离
- 每对情侣的数据完全独立
- 无法访问其他用户的积分和奖励
- 只有管理员可以查看全局数据

### 3. 会话管理
- 基于Token的认证机制
- Token有效期24小时
- 过期后自动跳转登录页面

---

## 🛠️ 技术架构

### 后端
- **框架**: FastAPI
- **数据库**: SQLite
- **认证**: Token-based (Bearer)
- **API文档**: 自动生成的Swagger UI

### 前端
- **框架**: Flask
- **UI库**: Bootstrap 5
- **图标**: Bootstrap Icons
- **状态管理**: localStorage

### 数据存储
- **数据库文件**: `data/heartbeat.db`
- **备份文件**: `data/system_data.json.backup`

---

## 📝 API接口说明

### 认证接口
- `POST /auth/register` - 用户注册
- `POST /auth/login` - 用户登录
- `POST /auth/logout` - 用户登出
- `GET /auth/me` - 获取当前用户信息

### 情侣管理
- `GET /couples/me` - 获取我的情侣信息
- `GET /couples/all` - 获取所有情侣（管理员）

### 积分管理
- `POST /points` - 更新积分
- `GET /points/history` - 获取积分历史

### 奖励管理
- `GET /rewards/base` - 获取基础奖励列表
- `GET /rewards` - 获取我的奖励
- `POST /rewards` - 创建奖励
- `PUT /rewards/{id}` - 更新奖励
- `DELETE /rewards/{id}` - 删除奖励

### 兑换管理
- `POST /exchanges` - 兑换奖励
- `GET /exchanges` - 获取我的兑换记录
- `GET /exchanges/all` - 获取所有兑换记录（管理员）

### 管理员接口
- `GET /admin/stats` - 获取系统统计

详细的API文档请访问: http://localhost:8000/docs

---

## 🐛 常见问题

### Q1: 登录后显示"未登录或会话已过期"
**A**: Token可能已过期，请重新登录。Token有效期为24小时。

### Q2: 无法访问某些页面（404错误）
**A**:
1. 确保前后端服务都已启动
2. 检查是否已登录
3. 尝试清除浏览器缓存后重新登录

### Q3: 积分更新失败
**A**:
1. 检查是否已登录
2. 确认输入的积分值和原因是否有效
3. 查看浏览器控制台是否有错误信息

### Q4: 无法兑换奖励
**A**:
1. 确认积分是否足够
2. 检查奖励库存是否充足
3. 确保奖励属于当前用户

### Q5: 忘记密码怎么办
**A**:
- 普通用户：联系管理员重置密码
- 管理员：需要直接修改数据库

---

## 🔄 数据迁移

如果您是从旧版本（JSON存储）升级到v2.0，请运行数据迁移脚本：

```bash
python scripts/migrate_data.py
```

迁移后：
- 原JSON数据会备份到 `data/system_data.json.backup`
- 所有情侣会自动创建账号
- 用户名格式：`couple_{原ID}`
- 默认密码：`123456`

---

## 📞 技术支持

如有问题，请查看：
1. 后端日志：查看终端输出
2. 前端日志：浏览器开发者工具 -> Console
3. API文档：http://localhost:8000/docs

---

## 📄 许可证

© 2025 心动积分项目 · 用爱记录每一刻

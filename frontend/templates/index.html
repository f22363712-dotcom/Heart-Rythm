{% extends 'base.html' %}

{% block title %}é¦–é¡µ{% endblock %}

{% block content %}
<div class="page-title">
    <span>âœ¨</span> æ¬¢è¿æ¥åˆ°å¿ƒåŠ¨ç§¯åˆ†
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="icon">ğŸ’‘</div>
        <h3>æƒ…ä¾£æ•°é‡</h3>
        <div class="value" id="stat-couples">{{ stats.total_couples if stats else '0' }}</div>
    </div>
    <div class="stat-card">
        <div class="icon">ğŸ</div>
        <h3>å¥–åŠ±æ•°é‡</h3>
        <div class="value" id="stat-rewards">{{ stats.total_rewards if stats else '0' }}</div>
    </div>
    <div class="stat-card">
        <div class="icon">â­</div>
        <h3>æ€»ç§¯åˆ†</h3>
        <div class="value" id="stat-points">{{ stats.total_points if stats else '0' }}</div>
    </div>
    <div class="stat-card">
        <div class="icon">ğŸ”„</div>
        <h3>å…‘æ¢æ¬¡æ•°</h3>
        <div class="value" id="stat-exchanges">{{ stats.total_exchanges if stats else '0' }}</div>
    </div>
</div>

<div class="card">
    <h3>ğŸ’• å…³äºå¿ƒåŠ¨ç§¯åˆ†</h3>
    <p style="color: var(--text-light); margin-bottom: 20px; line-height: 1.8;">
        å¿ƒåŠ¨ç§¯åˆ†æ˜¯ä¸€ä¸ªä¸“ä¸ºæƒ…ä¾£è®¾è®¡çš„ç§¯åˆ†ç®¡ç†ç³»ç»Ÿã€‚é€šè¿‡è®°å½•ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´ï¼Œ
        å°†å½¼æ­¤çš„ä»˜å‡ºè½¬åŒ–ä¸ºå¯ä»¥å…‘æ¢çš„"å¿ƒåŠ¨ç§¯åˆ†"ï¼Œè®©çˆ±æƒ…å˜å¾—æ›´åŠ ç”œèœœæœ‰è¶£ã€‚
        æ¯ä¸€æ¬¡çš„é™ªä¼´ã€æ¯ä¸€ä»½å…³å¿ƒï¼Œéƒ½å€¼å¾—è¢«è®°ä½å’Œå›æŠ¥ã€‚
    </p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 24px;">
        <div style="padding: 20px; background: linear-gradient(135deg, #fff0f5, #ffe4ec); border-radius: 16px;">
            <h4 style="color: var(--primary-rose); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                ğŸ’‘ æƒ…ä¾£ç®¡ç†
            </h4>
            <p style="color: var(--text-light); font-size: 0.9rem;">
                æ³¨å†Œæƒ…ä¾£ä¿¡æ¯ï¼Œè®°å½•åŒæ–¹çš„åå­—ï¼Œå¼€å¯ä¸“å±çš„ç§¯åˆ†ä¹‹æ—…ã€‚
            </p>
        </div>
        
        <div style="padding: 20px; background: linear-gradient(135deg, #f0f5ff, #e4ecff); border-radius: 16px;">
            <h4 style="color: #7c3aed; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                â­ ç§¯åˆ†å˜åŠ¨
            </h4>
            <p style="color: var(--text-light); font-size: 0.9rem;">
                å®Œæˆä»»åŠ¡è·å¾—ç§¯åˆ†ï¼Œè®°å½•æ¯ä¸€æ¬¡çš„ä»˜å‡ºå’Œæˆé•¿ã€‚
            </p>
        </div>
        
        <div style="padding: 20px; background: linear-gradient(135deg, #f0fff5, #e4ffec); border-radius: 16px;">
            <h4 style="color: #059669; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                ğŸ å¥–åŠ±å…‘æ¢
            </h4>
            <p style="color: var(--text-light); font-size: 0.9rem;">
                ç§¯ç´¯è¶³å¤Ÿç§¯åˆ†åï¼Œå¯ä»¥å…‘æ¢å„ç§ç”œèœœå¥–åŠ±ã€‚
            </p>
        </div>
        
        <div style="padding: 20px; background: linear-gradient(135deg, #fff5f0, #ffece4); border-radius: 16px;">
            <h4 style="color: #ea580c; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                ğŸ“Š æ•°æ®ç»Ÿè®¡
            </h4>
            <p style="color: var(--text-light); font-size: 0.9rem;">
                æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡ï¼Œäº†è§£ç§¯åˆ†å˜åŠ¨å’Œå…‘æ¢æƒ…å†µã€‚
            </p>
        </div>
    </div>
</div>

<div class="card" style="text-align: center; margin-top: 24px;">
    <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
    <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
        <a href="/couples" class="btn">ğŸ’‘ ç®¡ç†æƒ…ä¾£</a>
        <a href="/rewards" class="btn btn-secondary">ğŸ æŸ¥çœ‹å¥–åŠ±</a>
        <a href="/stats" class="btn btn-outline">ğŸ“Š æ•°æ®ç»Ÿè®¡</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // æ•°å­—æ»šåŠ¨åŠ¨ç”»
    function animateValue(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            element.textContent = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    // é¡µé¢åŠ è½½æ—¶è·å–ç»Ÿè®¡æ•°æ®å¹¶æ·»åŠ åŠ¨ç”»
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/stats/')
            .then(response => response.json())
            .then(data => {
                const elements = {
                    'stat-couples': data.total_couples || 0,
                    'stat-rewards': data.total_rewards || 0,
                    'stat-points': data.total_points || 0,
                    'stat-exchanges': data.total_exchanges || 0
                };
                
                Object.keys(elements).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        animateValue(el, 0, elements[id], 1000);
                    }
                });
            })
            .catch(error => {
                console.log('æ— æ³•è·å–ç»Ÿè®¡æ•°æ®ï¼Œåç«¯å¯èƒ½æœªå¯åŠ¨');
            });
    });
</script>
{% endblock %}
